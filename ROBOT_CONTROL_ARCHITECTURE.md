# ì² ê·¼ ê²°ì† ë¡œë´‡ ì œì–´ ì‹œìŠ¤í…œ êµ¬ì¡° ë¶„ì„

## ğŸ“‹ ëª©ì°¨
1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [í•˜ë“œì›¨ì–´ êµ¬ì„±](#í•˜ë“œì›¨ì–´-êµ¬ì„±)
3. [ROS2 íŒ¨í‚¤ì§€ êµ¬ì¡°](#ros2-íŒ¨í‚¤ì§€-êµ¬ì¡°)
4. [í†µí•© ì œì–´ ìŠ¤í¬ë¦½íŠ¸](#í†µí•©-ì œì–´-ìŠ¤í¬ë¦½íŠ¸)
5. [ì œì–´ íë¦„ë„](#ì œì–´-íë¦„ë„)
6. [ROS2 í† í”½ êµ¬ì¡°](#ros2-í† í”½-êµ¬ì¡°)
7. [ë…¸ë“œë³„ ìƒì„¸ ì„¤ëª…](#ë…¸ë“œë³„-ìƒì„¸-ì„¤ëª…)
8. [ì‚¬ìš© ë°©ë²•](#ì‚¬ìš©-ë°©ë²•)

---

## ì‹œìŠ¤í…œ ê°œìš”

ì² ê·¼ ê²°ì† ë¡œë´‡ì€ **ë¬´ì„  ë¦¬ëª¨ì½˜(Iron-MD)**ìœ¼ë¡œ ì¡°ì‘í•˜ì—¬ ë‹¤ìŒ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:
- ì£¼í–‰ (ì „ì§„/í›„ì§„/íšŒì „)
- 3ì¶• ìŠ¤í…Œì´ì§€ ì œì–´ (X, Y, Zì¶•)
- ë¦¬í”„íŒ… (ìƒìŠ¹/í•˜ê°•)
- ê·¸ë¦¬í¼ (ì—´ê¸°/ë‹«ê¸°)
- ê²°ì† íŠ¸ë¦¬ê±° ì‘ë™

### ì£¼ìš” íŠ¹ì§•
- **2ê°œ CAN ë²„ìŠ¤** ë¶„ë¦¬ ìš´ì˜ (ëª¨í„° ì œì–´ì™€ ë¦¬ëª¨ì½˜ í†µì‹  ê°„ì„­ ë°©ì§€)
- **7ê°œ RMD ëª¨í„°** ìœ„ì¹˜/ì†ë„ ì œì–´
- **Pololu ë¦¬ë‹ˆì–´ ì•¡ì¶”ì—ì´í„°** íŠ¸ë¦¬ê±° ì œì–´
- **Seengrip ê·¸ë¦¬í¼** Modbus RTU ì œì–´
- **ë¦¬ëª¨ì½˜ ì…ë ¥ â†’ ROS2 í† í”½ â†’ ëª¨í„° ì œì–´** êµ¬ì¡°

---

## í•˜ë“œì›¨ì–´ êµ¬ì„±

### CAN ë²„ìŠ¤ êµ¬ì¡°

| CAN ì¸í„°í˜ì´ìŠ¤ | ìš©ë„ | ì¥ì¹˜ | í†µì‹  ì†ë„ |
|---------------|------|------|----------|
| **can2** | ëª¨í„° ì œì–´ | RMD X4/X8 ëª¨í„° (0x141-0x147) | 1 Mbps |
| **can3** | ë¦¬ëª¨ì½˜ í†µì‹  | Iron-MD ë¬´ì„  ì¡°ì¢…ê¸° | 250 kbps |

> **ì¤‘ìš”**: CAN ë²„ìŠ¤ê°€ ë¶„ë¦¬ë˜ì–´ ìˆì–´ ë¦¬ëª¨ì½˜ í†µì‹ ê³¼ ëª¨í„° ì œì–´ê°€ ì„œë¡œ ê°„ì„­í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### ëª¨í„° ë°°ì¹˜

#### CAN2 (ëª¨í„° ì œì–´)
| ëª¨í„° ID | ê¸°ëŠ¥ | ì œì–´ ë°©ì‹ | ì„¤ëª… |
|---------|------|----------|------|
| **0x141** | ì¢Œì¸¡ êµ¬ë™ë¥œ | ì†ë„ ì œì–´ (cmd_vel) | ì£¼í–‰ ì „í›„ì§„/íšŒì „ |
| **0x142** | ìš°ì¸¡ êµ¬ë™ë¥œ | ì†ë„ ì œì–´ (cmd_vel) | ì£¼í–‰ ì „í›„ì§„/íšŒì „ |
| **0x143** | íš¡ì´ë™ | ìœ„ì¹˜ ì œì–´ | ì¢Œìš° ì´ë™ (50mm ë‹¨ìœ„) |
| **0x144** | Xì¶• | ìœ„ì¹˜ ì œì–´ | ìƒë¶€ì²´ Xì¶• ì´ë™ |
| **0x145** | Yì¶• | ìœ„ì¹˜ ì œì–´ | ìƒë¶€ì²´ Yì¶• ì´ë™ |
| **0x146** | Zì¶• (ë¦¬í”„íŒ…) | ìœ„ì¹˜ ì œì–´ | ìƒí•˜ ì´ë™ |
| **0x147** | Yaw íšŒì „ | ìœ„ì¹˜ ì œì–´ | 30ë„ ë‹¨ìœ„ íšŒì „ |

#### ì¶”ê°€ ë””ë°”ì´ìŠ¤
| ì¥ì¹˜ | í¬íŠ¸ | í”„ë¡œí† ì½œ | ê¸°ëŠ¥ |
|------|------|----------|------|
| **Pololu 18v7** | /dev/ttyACM0 | USB (SmcCmd) | íŠ¸ë¦¬ê±° ì„ í˜• ì•¡ì¶”ì—ì´í„° |
| **Seengrip ê·¸ë¦¬í¼** | /dev/ttyUSB0 | Modbus RTU (115200) | ê·¸ë¦½ ì—´ê¸°/ë‹«ê¸° (0-2000) |
| **EZI-IO** | 192.168.0.2:502 | Modbus TCP | ë¦¬ë¯¸íŠ¸ ì„¼ì„œ (ì˜µì…˜) |

---

## ROS2 íŒ¨í‚¤ì§€ êµ¬ì¡°

```
/home/test/ros2_ws/src/
â”œâ”€â”€ rmd_robot_control/          # RMD ëª¨í„° ì œì–´ íŒ¨í‚¤ì§€
â”‚   â”œâ”€â”€ position_control_node.py  # í†µí•© ì œì–´ ë…¸ë“œ (7ê°œ ëª¨í„°)
â”‚   â”œâ”€â”€ can_manager.py            # CAN ë²„ìŠ¤ ê´€ë¦¬
â”‚   â”œâ”€â”€ rmd_x4_protocol.py        # RMD ëª¨í„° í”„ë¡œí† ì½œ
â”‚   â””â”€â”€ launch/
â”‚       â””â”€â”€ robot_control.launch.py
â”‚
â”œâ”€â”€ rebar_control/              # ìƒìœ„ í†µí•© ì œì–´ íŒ¨í‚¤ì§€
â”‚   â”œâ”€â”€ iron_md_teleop_node.py  # Iron-MD ë¦¬ëª¨ì½˜ ë…¸ë“œ (can3)
â”‚   â”œâ”€â”€ teleop_node.py          # ì¼ë°˜ ì¡°ì´ìŠ¤í‹± ë…¸ë“œ (ì˜µì…˜)
â”‚   â”œâ”€â”€ safety_monitor.py       # ì•ˆì „ ê°ì‹œ
â”‚   â””â”€â”€ launch/
â”‚       â”œâ”€â”€ full_system.launch.py   # ì „ì²´ ì‹œìŠ¤í…œ ëŸ°ì¹˜
â”‚       â”œâ”€â”€ test_teleop.launch.py   # ë¦¬ëª¨ì½˜ í…ŒìŠ¤íŠ¸
â”‚       â””â”€â”€ test_driving.launch.py  # ì£¼í–‰ í…ŒìŠ¤íŠ¸
â”‚
â”œâ”€â”€ pololu_ros2/                # Pololu ì•¡ì¶”ì—ì´í„° íŒ¨í‚¤ì§€
â”‚   â””â”€â”€ pololu_node.py          # íŠ¸ë¦¬ê±° ì œì–´ ë…¸ë“œ
â”‚
â”œâ”€â”€ seengrip_ros2/              # Seengrip ê·¸ë¦¬í¼ íŒ¨í‚¤ì§€
â”‚   â””â”€â”€ seengrip_node.py        # ê·¸ë¦¬í¼ ì œì–´ ë…¸ë“œ
â”‚
â””â”€â”€ ezi_io_ros2/                # EZI-IO ë¦¬ë¯¸íŠ¸ ì„¼ì„œ íŒ¨í‚¤ì§€
    â””â”€â”€ ezi_io_node.py          # ì„¼ì„œ ì½ê¸° ë…¸ë“œ
```

---

## í†µí•© ì œì–´ ìŠ¤í¬ë¦½íŠ¸

### `integrated_control.sh` ë¶„ì„

```bash
#!/bin/bash
# ìœ„ì¹˜: /home/test/ros2_ws/integrated_control.sh

cd /home/test/ros2_ws
source /opt/ros/humble/setup.bash
source install/setup.bash

# 1ë‹¨ê³„: RMD ëª¨í„° ì œì–´ ë…¸ë“œ ì‹¤í–‰ (can2)
ros2 run rmd_robot_control position_control_node &
MOTOR_PID=$!
sleep 3

# 2ë‹¨ê³„: Iron-MD í…”ë ˆì˜µ ë…¸ë“œ ì‹¤í–‰ (can3)
ros2 run rebar_control iron_md_teleop &
TELEOP_PID=$!
sleep 2

# ê³„ì† ì‹¤í–‰ (Ctrl+Cë¡œ ì¢…ë£Œ)
wait
```

### ì‹¤í–‰ ìˆœì„œ
1. **position_control_node** ì‹œì‘ â†’ CAN2ì—ì„œ 7ê°œ ëª¨í„° ì œì–´ ì¤€ë¹„
2. 3ì´ˆ ëŒ€ê¸° â†’ ëª¨í„° ë…¸ë“œ ì™„ì „ ì´ˆê¸°í™”
3. **iron_md_teleop** ì‹œì‘ â†’ CAN3ì—ì„œ ë¦¬ëª¨ì½˜ ì…ë ¥ ìˆ˜ì‹ 
4. 2ì´ˆ ëŒ€ê¸° â†’ ë¦¬ëª¨ì½˜ ë…¸ë“œ ì´ˆê¸°í™”
5. ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ ìœ ì§€

---

## ì œì–´ íë¦„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Iron-MD ë¬´ì„  ë¦¬ëª¨ì½˜                          â”‚
â”‚  (Joystick AN1/AN2/AN3, Switches S13/S14/S17-S24, Emergency Stop) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ CAN3 (250kbps)
               â”‚ 0x1E4: ì¡°ì´ìŠ¤í‹± ë°ì´í„° (50ms)
               â”‚ 0x2E4: ìŠ¤ìœ„ì¹˜ ìƒíƒœ (50ms)
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              iron_md_teleop_node (ROS2 ë…¸ë“œ)                      â”‚
â”‚  - CAN ë©”ì‹œì§€ íŒŒì‹±                                                â”‚
â”‚  - ì¡°ì´ìŠ¤í‹± â†’ cmd_vel ë³€í™˜                                        â”‚
â”‚  - ìŠ¤ìœ„ì¹˜ â†’ ê´€ì ˆ ìœ„ì¹˜ ëª…ë ¹ ë³€í™˜                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ ROS2 í† í”½ ë°œí–‰
               â”‚
               â”œâ”€â–º /cmd_vel (Twist)                  â†’ 0x141, 0x142 (ì£¼í–‰)
               â”œâ”€â–º /joint_1/position (Float64MultiArray) â†’ 0x146 (ë¦¬í”„íŒ…)
               â”œâ”€â–º /joint_2/position (Float64MultiArray) â†’ 0x144 (Xì¶•)
               â”œâ”€â–º /joint_3/position (Float64MultiArray) â†’ 0x145 (Yì¶•)
               â”œâ”€â–º /joint_4/position (Float64MultiArray) â†’ 0x143 (íš¡ì´ë™)
               â”œâ”€â–º /joint_5/position (Float64MultiArray) â†’ 0x147 (Yaw)
               â”œâ”€â–º /gripper/position (Float32)       â†’ Seengrip
               â””â”€â–º /motor_0/vel (Float32)            â†’ Pololu íŠ¸ë¦¬ê±°
               
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           position_control_node (í†µí•© ì œì–´ ë…¸ë“œ)                   â”‚
â”‚  - cmd_vel â†’ ì°¨ë“± êµ¬ë™ ê³„ì‚° (ì¢Œìš° ë°”í€´ RPM)                       â”‚
â”‚  - ìœ„ì¹˜ ëª…ë ¹ â†’ RMD ìœ„ì¹˜ ì œì–´ ëª…ë ¹ ìƒì„±                            â”‚
â”‚  - ë¸Œë ˆì´í¬ ì„œë¹„ìŠ¤ ì œê³µ (safe_brake_release/lock)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ CAN2 (1 Mbps)
               â”‚
               â”œâ”€â–º 0x141 (ì¢Œì¸¡ ë°”í€´): ì†ë„ ì œì–´ ëª…ë ¹
               â”œâ”€â–º 0x142 (ìš°ì¸¡ ë°”í€´): ì†ë„ ì œì–´ ëª…ë ¹
               â”œâ”€â–º 0x143 (íš¡ì´ë™): ìœ„ì¹˜ ì œì–´ ëª…ë ¹
               â”œâ”€â–º 0x144 (Xì¶•): ìœ„ì¹˜ ì œì–´ ëª…ë ¹
               â”œâ”€â–º 0x145 (Yì¶•): ìœ„ì¹˜ ì œì–´ ëª…ë ¹
               â”œâ”€â–º 0x146 (Zì¶•): ìœ„ì¹˜ ì œì–´ ëª…ë ¹
               â””â”€â–º 0x147 (Yaw): ìœ„ì¹˜ ì œì–´ ëª…ë ¹
               
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RMD X4/X8 ëª¨í„° (7ê°œ)                         â”‚
â”‚  ì‘ë‹µ: 0x241-0x247 (ìœ„ì¹˜, ì†ë„, í† í¬ í”¼ë“œë°±)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì¶”ê°€ ë””ë°”ì´ìŠ¤ ë…¸ë“œë“¤                            â”‚
â”‚  - pololu_node: /dev/ttyACM0 (SmcCmd ë˜í¼)                        â”‚
â”‚  - seengrip_node: /dev/ttyUSB0 (Modbus RTU)                       â”‚
â”‚  - ezi_io_node: 192.168.0.2:502 (Modbus TCP, ì˜µì…˜)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ROS2 í† í”½ êµ¬ì¡°

### ë°œí–‰ í† í”½ (iron_md_teleop_node â†’ position_control_node)

| í† í”½ ì´ë¦„ | ë©”ì‹œì§€ íƒ€ì… | ëŒ€ìƒ ëª¨í„° | ì„¤ëª… |
|----------|-----------|----------|------|
| `/cmd_vel` | geometry_msgs/Twist | 0x141, 0x142 | ì£¼í–‰ ì œì–´ (linear.x, angular.z) |
| `/joint_1/position` | std_msgs/Float64MultiArray | 0x146 | ë¦¬í”„íŒ… ìœ„ì¹˜ (ë„) |
| `/joint_2/position` | std_msgs/Float64MultiArray | 0x144 | Xì¶• ìœ„ì¹˜ (ë„) |
| `/joint_3/position` | std_msgs/Float64MultiArray | 0x145 | Yì¶• ìœ„ì¹˜ (ë„) |
| `/joint_4/position` | std_msgs/Float64MultiArray | 0x143 | íš¡ì´ë™ ìœ„ì¹˜ (ë„) |
| `/joint_5/position` | std_msgs/Float64MultiArray | 0x147 | Yaw íšŒì „ ìœ„ì¹˜ (ë„) |
| `/gripper/position` | std_msgs/Float32 | Seengrip | ê·¸ë¦¬í¼ ìœ„ì¹˜ (0-2000) |
| `/motor_0/vel` | std_msgs/Float32 | Pololu | íŠ¸ë¦¬ê±° ì†ë„ (Â±3200) |
| `/emergency_stop` | std_msgs/Bool | ì „ì²´ | ë¹„ìƒ ì •ì§€ í”Œë˜ê·¸ |

### êµ¬ë… í† í”½ (position_control_node í”¼ë“œë°±)

| í† í”½ ì´ë¦„ | ë©”ì‹œì§€ íƒ€ì… | ì„¤ëª… |
|----------|-----------|------|
| `/joint_states` | sensor_msgs/JointState | ì „ì²´ ê´€ì ˆ ìƒíƒœ (ìœ„ì¹˜/ì†ë„/í† í¬) |
| `/motor_status` | std_msgs/Float64MultiArray | ëª¨í„°ë³„ ìƒíƒœ ë°°ì—´ |
| `/motor_0x141_rpm` | std_msgs/Float32 | ì¢Œì¸¡ ë°”í€´ RPM |
| `/motor_0x142_rpm` | std_msgs/Float32 | ìš°ì¸¡ ë°”í€´ RPM |

### ì„œë¹„ìŠ¤

| ì„œë¹„ìŠ¤ ì´ë¦„ | íƒ€ì… | ì„¤ëª… |
|------------|------|------|
| `/safe_brake_release` | std_srvs/Trigger | ë¸Œë ˆì´í¬ í•´ì œ (7ê°œ ëª¨í„° ìˆœì°¨) |
| `/safe_brake_lock` | std_srvs/Trigger | ë¸Œë ˆì´í¬ ì ê¸ˆ (7ê°œ ëª¨í„° ìˆœì°¨) |

---

## ë…¸ë“œë³„ ìƒì„¸ ì„¤ëª…

### 1. `iron_md_teleop_node` (ë¦¬ëª¨ì½˜ ì…ë ¥ ë…¸ë“œ)

**íŒŒì¼**: `/home/test/ros2_ws/src/rebar_control/rebar_control/iron_md_teleop_node.py`

#### ì£¼ìš” ê¸°ëŠ¥
- CAN3ì—ì„œ Iron-MD ë¦¬ëª¨ì½˜ ë©”ì‹œì§€ ìˆ˜ì‹ 
- ì¡°ì´ìŠ¤í‹± ì•„ë‚ ë¡œê·¸ ê°’ â†’ ROS2 í† í”½ ë³€í™˜
- ìŠ¤ìœ„ì¹˜ ì…ë ¥ â†’ ëª¨í„° ì œì–´ ëª…ë ¹ ë³€í™˜
- ë¸Œë ˆì´í¬ ì œì–´ (S13 ë²„íŠ¼)
- ìœ„ì¹˜ ë¦¬ì…‹ (S14 ë²„íŠ¼)

#### CAN ë©”ì‹œì§€ ì²˜ë¦¬
```python
# 0x1E4 (484): ì¡°ì´ìŠ¤í‹± ì•„ë‚ ë¡œê·¸ ë°ì´í„°
AN1 (byte 0): Xì¶• ì¡°ì´ìŠ¤í‹± (0-255, ì¤‘ë¦½ 127)
AN2 (byte 1): Yì¶• ì¡°ì´ìŠ¤í‹±
AN3 (byte 2): ì£¼í–‰ ì¡°ì´ìŠ¤í‹±
AN4 (byte 3): ì˜ˆë¹„

# 0x2E4 (740): ìŠ¤ìœ„ì¹˜ ìƒíƒœ
S00-S24: ê°ì¢… ë²„íŠ¼/ìŠ¤ìœ„ì¹˜ (0=OFF, 1=ON)
Emergency_Stop_Active: ë¹„ìƒ ì •ì§€ í™œì„±í™”
TX_Connected: ë¦¬ëª¨ì½˜ ì—°ê²° ìƒíƒœ
```

#### ì¡°ì´ìŠ¤í‹± ë§¤í•‘
| ì…ë ¥ | ì¶œë ¥ í† í”½ | ëŒ€ìƒ ëª¨í„° | ì„¤ëª… |
|------|----------|----------|------|
| AN3 (ì„¸ë¡œ) | `/cmd_vel` linear.x | 0x141, 0x142 | ì „ì§„/í›„ì§„ |
| AN3 (ê°€ë¡œ) | `/cmd_vel` angular.z | 0x141, 0x142 | ì¢Œìš° íšŒì „ |
| AN1 | `/joint_2/position` | 0x144 | Xì¶• ì´ë™ |
| AN2 | `/joint_3/position` | 0x145 | Yì¶• ì´ë™ |

#### ìŠ¤ìœ„ì¹˜ ë§¤í•‘
| ìŠ¤ìœ„ì¹˜ | ë™ì‘ | ëŒ€ìƒ | ì„¤ëª… |
|--------|------|------|------|
| S13 | ë¸Œë ˆì´í¬ í† ê¸€ | ì „ì²´ ëª¨í„° | í•´ì œâ†”ì ê¸ˆ |
| S14 | ìœ„ì¹˜ ë¦¬ì…‹ | ìœ„ì¹˜ì œì–´ ëª¨í„° | í˜„ì¬ ìœ„ì¹˜ â†’ 0Â° |
| S17/S18 | íš¡ì´ë™ Â±50mm | 0x143 | ì¢Œìš° ì´ë™ |
| S23/S24 | Yaw Â±30Â° | 0x147 | íšŒì „ |
| S21/S22 | ì‘ì—… ì‹œí€€ìŠ¤ | ì—¬ëŸ¬ ëª¨í„° | ìë™ ì‘ì—… |
| S00 | íŠ¸ë¦¬ê±° ë‹¹ê¹€ | Pololu | ê²°ì† ê±´ ì‘ë™ |
| Emergency | ë¹„ìƒ ì •ì§€ | ì „ì²´ | ëª¨ë“  ëª¨í„° ì •ì§€ |

#### ì œì–´ ë£¨í”„
```python
# 20Hz (0.05ì´ˆë§ˆë‹¤ ì‹¤í–‰)
def control_loop(self):
    # 1. ì¡°ì´ìŠ¤í‹± ê°’ ì½ê¸° (AN1/AN2/AN3)
    # 2. cmd_vel ê³„ì‚° ë° ë°œí–‰ (ì£¼í–‰)
    # 3. ê´€ì ˆ ìœ„ì¹˜ ëª…ë ¹ ê³„ì‚° (X/Yì¶•)
    # 4. ìŠ¤ìœ„ì¹˜ ìƒíƒœ í™•ì¸ (ì—£ì§€ ê°ì§€)
    # 5. ëª…ë ¹ ë°œí–‰
```

---

### 2. `position_control_node` (í†µí•© ëª¨í„° ì œì–´ ë…¸ë“œ)

**íŒŒì¼**: `/home/test/ros2_ws/src/rmd_robot_control/rmd_robot_control/position_control_node.py`

#### ì£¼ìš” ê¸°ëŠ¥
- **7ê°œ RMD ëª¨í„°** í†µí•© ì œì–´
  - 0x141, 0x142: ì†ë„ ì œì–´ (ì£¼í–‰)
  - 0x143-0x147: ìœ„ì¹˜ ì œì–´ (ê´€ì ˆ)
- cmd_vel â†’ ì°¨ë“± êµ¬ë™ (differential drive) ë³€í™˜
- ìœ„ì¹˜ ëª…ë ¹ â†’ RMD ìœ„ì¹˜ ì œì–´ í”„ë¡œí† ì½œ ë³€í™˜
- ë¸Œë ˆì´í¬ ì„œë¹„ìŠ¤ ì œê³µ
- CAN2 ë²„ìŠ¤ í†µì‹ 

#### cmd_vel ì²˜ë¦¬ (ì°¨ë“± êµ¬ë™)
```python
def cmd_vel_callback(self, msg):
    linear_vel = msg.linear.x   # m/s
    angular_vel = msg.angular.z # rad/s
    
    # ì°¨ë“± êµ¬ë™ ê³„ì‚°
    left_vel = (linear_vel - angular_vel * wheel_base / 2) / wheel_radius
    right_vel = (linear_vel + angular_vel * wheel_base / 2) / wheel_radius
    
    # rad/s â†’ RPM ë³€í™˜
    left_rpm = left_vel * 60 / (2 * Ï€)
    right_rpm = right_vel * 60 / (2 * Ï€)
    
    # CAN ëª…ë ¹ ì „ì†¡
    send_speed_command(0x141, left_rpm)
    send_speed_command(0x142, right_rpm)
```

#### ìœ„ì¹˜ ì œì–´ ì²˜ë¦¬
```python
def single_joint_callback(self, msg, joint_idx):
    motor_id = self.motor_ids[joint_idx]  # 0x143-0x147
    target_position = msg.data[0]  # ë„(degree)
    
    # ì•ˆì „ ì œí•œ
    target_position = clamp(target_position, min_position, max_position)
    
    # RMD ìœ„ì¹˜ ì œì–´ ëª…ë ¹ ìƒì„±
    command = protocol.create_position_command(target_position)
    
    # CAN ì „ì†¡
    can_manager.send_frame(motor_id, command)
```

#### ë¸Œë ˆì´í¬ ì œì–´
```python
def safe_brake_release(self):
    """ìˆœì°¨ì  ë¸Œë ˆì´í¬ í•´ì œ (CAN ë²„ìŠ¤ ë³´í˜¸)"""
    for motor_id in [0x143, 0x144, 0x145, 0x146, 0x147]:
        send_brake_release_command(motor_id)
        time.sleep(0.1)  # 100ms ê°„ê²©
```

---

### 3. `pololu_node` (íŠ¸ë¦¬ê±° ì•¡ì¶”ì—ì´í„°)

**íŒŒì¼**: `/home/test/ros2_ws/src/pololu_ros2/pololu_ros2/pololu_node.py`

#### ì£¼ìš” ê¸°ëŠ¥
- Pololu 18v7 Simple Motor Controller ì œì–´
- `/motor_0/vel` í† í”½ êµ¬ë… (ì†ë„ ëª…ë ¹)
- SmcCmd subprocess ë˜í¼ ì‚¬ìš©
- íŠ¸ë¦¬ê±° ë‹¹ê¹€/í•´ì œ ë™ì‘

#### ì œì–´ ë°©ì‹
```python
# SmcCmd ëª…ë ¹ì–´ ì‚¬ìš© (USB libusb)
def set_speed(self, speed):
    """ì†ë„ ì„¤ì • (-3200 ~ +3200)"""
    subprocess.run(['SmcCmd', '--speed', str(speed)])

# íŠ¸ë¦¬ê±° ë™ì‘
trigger_pull():   set_speed(3200)   # ì „ì§„
trigger_release(): set_speed(-3200) # í›„ì§„
stop():           set_speed(0)      # ì •ì§€
```

---

### 4. `seengrip_node` (ê·¸ë¦¬í¼ ì œì–´)

**íŒŒì¼**: `/home/test/ros2_ws/src/seengrip_ros2/seengrip_ros2/seengrip_node.py`

#### ì£¼ìš” ê¸°ëŠ¥
- Seengrip ê·¸ë¦¬í¼ Modbus RTU ì œì–´
- `/gripper/position` í† í”½ êµ¬ë…
- RS485-USB ì–´ëŒ‘í„° ì‚¬ìš© (/dev/ttyUSB0)

#### ì œì–´ ë°©ì‹
```python
# Modbus RTU ë ˆì§€ìŠ¤í„° ì“°ê¸°
def set_gripper_position(self, position):
    """ê·¸ë¦¬í¼ ìœ„ì¹˜ ì„¤ì • (0-2000)"""
    mb.WriteReg(slave_id=1, MB_GOAL_SPD, 500)  # ì†ë„
    mb.WriteReg(slave_id=1, MB_GOAL_POS, position)  # ëª©í‘œ ìœ„ì¹˜

# ë¯¸ë¦¬ ì •ì˜ëœ ë™ì‘
open_gripper():  set_position(0)     # ì™„ì „ ì—´ë¦¼
close_gripper(): set_position(2000)  # ì™„ì „ ë‹«í˜
```

---

## ì‚¬ìš© ë°©ë²•

### 1. í†µí•© ì œì–´ ì‹œì‘

```bash
cd /home/test/ros2_ws
./integrated_control.sh
```

**ì‹¤í–‰ ê²°ê³¼**:
```
==========================================
í†µí•© ì œì–´ ì‹œìŠ¤í…œ ì‹œì‘
==========================================

CAN ì¸í„°í˜ì´ìŠ¤ ìƒíƒœ:
can2: <NOARP,UP,LOWER_UP,ECHO> mtu 16 qdisc pfifo_fast state UP mode DEFAULT
can3: <NOARP,UP,LOWER_UP,ECHO> mtu 16 qdisc pfifo_fast state UP mode DEFAULT

==========================================
1. RMD ëª¨í„° ì œì–´ ë…¸ë“œ ì‹¤í–‰ (can2)
==========================================
âœ… CAN can2 ì—°ê²° ì„±ê³µ (í†µí•© ë…¸ë“œ)
âœ… í†µí•© ë…¸ë“œ ì´ˆê¸°í™” ì™„ë£Œ (7ê°œ ëª¨í„°)

==========================================
2. Iron-MD í…”ë ˆì˜µ ë…¸ë“œ ì‹¤í–‰ (can3)
==========================================
âœ… CAN can3 ì—°ê²° ì„±ê³µ (Iron-MD)
âœ… ì¡°ì¢…ê¸° ì—°ê²°ë¨ (TX_Connected)

==========================================
âœ… í†µí•© ì œì–´ ì‹œìŠ¤í…œ ì‹œì‘ ì™„ë£Œ!
==========================================
```

---

### 2. ë¸Œë ˆì´í¬ ì œì–´

#### ë¦¬ëª¨ì½˜ìœ¼ë¡œ (S13 ë²„íŠ¼)
```
S13 ë²„íŠ¼ 1íšŒ ëˆ„ë¦„ â†’ ë¸Œë ˆì´í¬ í•´ì œ (ëª¨í„° ì›€ì§ì¼ ìˆ˜ ìˆìŒ)
S13 ë²„íŠ¼ 2íšŒ ëˆ„ë¦„ â†’ ë¸Œë ˆì´í¬ ì ê¸ˆ (ëª¨í„° ê³ ì •)
```

#### ì„œë¹„ìŠ¤ë¡œ (ë³„ë„ í„°ë¯¸ë„)
```bash
# ë¸Œë ˆì´í¬ í•´ì œ
ros2 service call /safe_brake_release std_srvs/srv/Trigger

# ë¸Œë ˆì´í¬ ì ê¸ˆ
ros2 service call /safe_brake_lock std_srvs/srv/Trigger
```

---

### 3. ì¡°ì‘ ë°©ë²•

#### ì£¼í–‰ (AN3 ì¡°ì´ìŠ¤í‹±)
```
AN3 ì„¸ë¡œ â†’ ì „ì§„/í›„ì§„
AN3 ê°€ë¡œ â†’ ì¢Œìš° íšŒì „

ì˜ˆ: ì „ì§„í•˜ë©´ì„œ ìš°íšŒì „
  - AN3 ì„¸ë¡œ ìœ„ë¡œ + AN3 ê°€ë¡œ ì˜¤ë¥¸ìª½
  â†’ cmd_vel: linear.x=0.5, angular.z=0.3
  â†’ 0x141 (ì¢Œ): ë¹ ë¥´ê²Œ, 0x142 (ìš°): ëŠë¦¬ê²Œ
```

#### ìŠ¤í…Œì´ì§€ ì œì–´ (AN1/AN2 ì¡°ì´ìŠ¤í‹±)
```
AN1 ê°€ë¡œ â†’ Xì¶• ì¢Œìš° ì´ë™ (0x144)
AN2 ì„¸ë¡œ â†’ Yì¶• ì „í›„ ì´ë™ (0x145)

ì˜ˆ: Xì¶• ì˜¤ë¥¸ìª½ìœ¼ë¡œ 10mm ì´ë™
  - AN1 ê°€ë¡œ ì˜¤ë¥¸ìª½
  â†’ /joint_2/position: [10.0]  # ë„(degree) ë‹¨ìœ„
  â†’ 0x144ë¡œ ìœ„ì¹˜ ì œì–´ ëª…ë ¹ ì „ì†¡
```

#### íš¡ì´ë™ (S17/S18 ìŠ¤ìœ„ì¹˜)
```
S17 ë²„íŠ¼ â†’ ì˜¤ë¥¸ìª½ 50mm ì´ë™ (0x143)
S18 ë²„íŠ¼ â†’ ì™¼ìª½ 50mm ì´ë™ (0x143)

ì˜ˆ: S17 ëˆ„ë¦„ â†’ current_lateral + 50mm
```

#### Yaw íšŒì „ (S23/S24 ìŠ¤ìœ„ì¹˜)
```
S23 ë²„íŠ¼ â†’ ì‹œê³„ë°©í–¥ 30Â° (0x147)
S24 ë²„íŠ¼ â†’ ë°˜ì‹œê³„ë°©í–¥ 30Â° (0x147)

ì˜ˆ: S23 ëˆ„ë¦„ â†’ current_yaw + 30Â°
```

#### ê·¸ë¦¬í¼ (R1/R2 ë²„íŠ¼)
```
R1 ë²„íŠ¼ â†’ ê·¸ë¦¬í¼ ì—´ê¸° (position=0)
R2 ë²„íŠ¼ â†’ ê·¸ë¦¬í¼ ë‹«ê¸° (position=2000)
```

#### íŠ¸ë¦¬ê±° (S00 ë²„íŠ¼)
```
S00 ë²„íŠ¼ ëˆ„ë¦„ â†’ íŠ¸ë¦¬ê±° ë‹¹ê¹€ (0.5ì´ˆ)
  - Pololu ì „ì§„ (3200)
  - 0.5ì´ˆ í›„ ìë™ ì •ì§€
```

#### ë¹„ìƒ ì •ì§€
```
Emergency_Stop ë²„íŠ¼ â†’ ëª¨ë“  ëª¨í„° ì¦‰ì‹œ ì •ì§€
  - /emergency_stop í† í”½: True
  - ëª¨ë“  ì œì–´ ëª…ë ¹ ë¬´ì‹œ
  - START ë²„íŠ¼ìœ¼ë¡œ í•´ì œ
```

---

### 4. ëª¨ë‹ˆí„°ë§ (ë³„ë„ í„°ë¯¸ë„)

#### ROS2 í† í”½ í™•ì¸
```bash
# ì£¼í–‰ ì†ë„ í™•ì¸
ros2 topic echo /cmd_vel

# ê´€ì ˆ ìƒíƒœ í™•ì¸
ros2 topic echo /joint_states

# ê°œë³„ ëª¨í„° RPM í™•ì¸
ros2 topic echo /motor_0x141_rpm
ros2 topic echo /motor_0x142_rpm
```

#### CAN ë²„ìŠ¤ ëª¨ë‹ˆí„°ë§
```bash
# ëª¨í„° ì œì–´ CAN ë²„ìŠ¤
candump can2

# ë¦¬ëª¨ì½˜ CAN ë²„ìŠ¤
candump can3
```

#### ë…¸ë“œ ìƒíƒœ í™•ì¸
```bash
# ì‹¤í–‰ ì¤‘ì¸ ë…¸ë“œ ëª©ë¡
ros2 node list

# ì„œë¹„ìŠ¤ ëª©ë¡
ros2 service list

# í† í”½ ëª©ë¡
ros2 topic list
```

---

### 5. ê°œë³„ í…ŒìŠ¤íŠ¸

#### ì£¼í–‰ë§Œ í…ŒìŠ¤íŠ¸
```bash
cd /home/test/ros2_ws
source install/setup.bash
ros2 run rmd_robot_control position_control_node &
ros2 topic pub /cmd_vel geometry_msgs/Twist "{linear: {x: 0.3}, angular: {z: 0.0}}" -r 10
```

#### ìœ„ì¹˜ ì œì–´ë§Œ í…ŒìŠ¤íŠ¸
```bash
# Xì¶• ëª¨í„° (0x144) 10ë„ ì´ë™
ros2 topic pub /joint_2/position std_msgs/Float64MultiArray "{data: [10.0]}" --once
```

#### ê·¸ë¦¬í¼ í…ŒìŠ¤íŠ¸
```bash
# ê·¸ë¦¬í¼ ë‹«ê¸°
ros2 topic pub /gripper/position std_msgs/Float32 "{data: 2000.0}" --once

# ê·¸ë¦¬í¼ ì—´ê¸°
ros2 topic pub /gripper/position std_msgs/Float32 "{data: 0.0}" --once
```

#### Pololu íŠ¸ë¦¬ê±° í…ŒìŠ¤íŠ¸
```bash
# ì „ì§„ (ë‹¹ê¹€)
ros2 topic pub /motor_0/vel std_msgs/Float32 "{data: 3200.0}" --once

# ì •ì§€
ros2 topic pub /motor_0/vel std_msgs/Float32 "{data: 0.0}" --once

# í›„ì§„ (í•´ì œ)
ros2 topic pub /motor_0/vel std_msgs/Float32 "{data: -3200.0}" --once
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### CAN ë²„ìŠ¤ ì˜¤ë¥˜

#### Bus-off ìƒíƒœ
```bash
# ì¦ìƒ: ëª¨í„°ê°€ ì‘ë‹µí•˜ì§€ ì•ŠìŒ
# ì›ì¸: CAN ë²„ìŠ¤ ê³¼ë¶€í•˜, ë™ì‹œ ì „ì†¡ ê³¼ë‹¤

# í•´ê²°:
sudo ip link set can2 type can restart-ms 100
sudo ip link set can2 up
```

#### CAN ì¸í„°í˜ì´ìŠ¤ DOWN
```bash
# í™•ì¸
ip link show can2
ip link show can3

# ì¬ì‹œì‘
sudo ip link set can2 down
sudo ip link set can2 up type can bitrate 1000000
sudo ip link set can3 down
sudo ip link set can3 up type can bitrate 250000
```

### ë¸Œë ˆì´í¬ ë¬¸ì œ

#### ë¸Œë ˆì´í¬ê°€ í•´ì œë˜ì§€ ì•ŠìŒ
```bash
# ì„œë¹„ìŠ¤ë¡œ ê°•ì œ í•´ì œ
ros2 service call /safe_brake_release std_srvs/srv/Trigger

# ê°œë³„ ëª¨í„° í•´ì œ (candumpìœ¼ë¡œ í™•ì¸)
candump can2 &
ros2 service call /safe_brake_release std_srvs/srv/Trigger
```

### ë¦¬ëª¨ì½˜ ì—°ê²° ë¬¸ì œ

#### TX_Connected = 0 (ì—°ê²° ì•ˆ ë¨)
```bash
# CAN3 ìƒíƒœ í™•ì¸
ip link show can3

# Heartbeat í™•ì¸ (1892, 0x764)
candump can3 | grep 764

# ë¦¬ëª¨ì½˜ ì „ì› í™•ì¸ ë° ì¬ë¶€íŒ…
```

### Pololu/Seengrip ë¬¸ì œ

#### Pololu ì‘ë‹µ ì—†ìŒ
```bash
# í¬íŠ¸ í™•ì¸
ls -l /dev/ttyACM*

# SmcCmd í…ŒìŠ¤íŠ¸
SmcCmd --status

# ìˆ˜ë™ ì œì–´
SmcCmd --speed 1000
SmcCmd --stop
```

#### Seengrip ì‘ë‹µ ì—†ìŒ
```bash
# í¬íŠ¸ í™•ì¸
ls -l /dev/ttyUSB*

# í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
cd /home/test/ros2_ws
python3 test_seengrip_simplemodbus.py
```

---

## ìš”ì•½

### ì œì–´ íë¦„
```
ë¦¬ëª¨ì½˜ ì…ë ¥ (CAN3)
  â†“
iron_md_teleop_node (CAN íŒŒì‹±)
  â†“
ROS2 í† í”½ (/cmd_vel, /joint_X/position)
  â†“
position_control_node (ëª¨í„° ëª…ë ¹ ìƒì„±)
  â†“
CAN2 ì „ì†¡ â†’ RMD ëª¨í„° (0x141-0x147)
```

### í•µì‹¬ êµ¬ì„±ìš”ì†Œ
- **2ê°œ CAN ë²„ìŠ¤**: can2(ëª¨í„°), can3(ë¦¬ëª¨ì½˜)
- **2ê°œ ROS2 ë…¸ë“œ**: iron_md_teleop, position_control_node
- **7ê°œ RMD ëª¨í„°**: ì£¼í–‰(2) + ê´€ì ˆ(5)
- **2ê°œ ì¶”ê°€ ë””ë°”ì´ìŠ¤**: Pololu, Seengrip

### ì£¼ìš” í† í”½
- `/cmd_vel`: ì£¼í–‰ ì œì–´ (0x141, 0x142)
- `/joint_X/position`: ê´€ì ˆ ìœ„ì¹˜ ì œì–´ (0x143-0x147)
- `/gripper/position`: ê·¸ë¦¬í¼ ìœ„ì¹˜
- `/motor_0/vel`: íŠ¸ë¦¬ê±° ì†ë„

### ì•ˆì „ ê¸°ëŠ¥
- S13: ë¸Œë ˆì´í¬ í† ê¸€
- Emergency_Stop: ë¹„ìƒ ì •ì§€
- ìˆœì°¨ ë¸Œë ˆì´í¬ í•´ì œ (CAN ë²„ìŠ¤ ë³´í˜¸)
- ìœ„ì¹˜ ì œí•œ (min/max clamp)

---

## ì°¸ê³  ë¬¸ì„œ
- `MOTOR_CONTROL_GUIDE.md` - Pololu/Seengrip ê°œë³„ ì œì–´
- `CAN_REMOTE_CONTROL_ì ìš©ì™„ë£Œ.md` - CAN ë¦¬ëª¨ì½˜ ì„¤ì •
- `MOTOR_CONTROL_GUIDE.md` - ëª¨í„° ì œì–´ ê°€ì´ë“œ
