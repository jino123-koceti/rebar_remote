# μ² κ·Ό κ²°μ† μλ™ν™” λ΅λ΄‡ - ν†µν•© ν•μ„μ μ–΄ μ‹μ¤ν…

ROS2 Humble κΈ°λ° μ² κ·Ό κ²°μ† λ΅λ΄‡μ μ™„μ „ν• ν•μ„μ μ–΄ μ‹μ¤ν…μ…λ‹λ‹¤.

## π“‹ μ‹μ¤ν… κ°μ”

### λ΅λ΄‡ κµ¬μ„±

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚              μ² κ·Ό κ²°μ† μλ™ν™” λ΅λ΄‡                       β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                                                           β”‚
β”‚  [ν•λ¶€μ²΄ - μ£Όν–‰ μ‹μ¤ν…]                                   β”‚
β”‚   β”β”€ 0x141, 0x142: λ¬΄ν•κ¶¤λ„ μ£Όν–‰ λ¨ν„° (RMD-X4)          β”‚
β”‚   β””β”€ 0x143: λ¦¬ν”„ν… μ΅°μΈνΈ (50mm step μƒμΉ/ν•κ°•)          β”‚
β”‚                                                           β”‚
β”‚  [μƒλ¶€μ²΄ - μ‘μ—… μ‹μ¤ν…]                                   β”‚
β”‚   β”β”€ XYZ μ¤ν…μ΄μ§€ (κ³µκµ¬ μ΄μ†΅)                            β”‚
β”‚   β”‚   β”β”€ 0x144: Xμ¶• λ¨ν„°                                 β”‚
β”‚   β”‚   β”β”€ 0x145: Yμ¶• λ¨ν„°                                 β”‚
β”‚   β”‚   β””β”€ 0x146: Zμ¶• λ¨ν„°                                 β”‚
β”‚   β”β”€ 0x147: Yaw νμ „ λ¨ν„°                                β”‚
β”‚   β”β”€ Pololu μ•΅μ¶”μ—μ΄ν„°: κ²°μ†κ±΄ νΈλ¦¬κ±°                     β”‚
β”‚   β””β”€ Seengrip κ·Έλ¦¬νΌ: μ² κ·Ό κ³ μ •                          β”‚
β”‚                                                           β”‚
β”‚  [μ„Όμ„]                                                   β”‚
β”‚   β”β”€ EZI-IO: XYZ μ¤ν…μ΄μ§€ λ¦¬λ―ΈνΈ μ„Όμ„ (6κ°)              β”‚
β”‚   β”β”€ ZED X (2λ€): μ „/ν›„λ°© μ£Όν–‰μ©                         β”‚
β”‚   β””β”€ ZED X Mini (2λ€): μ‘μ—…μμ—­ κµμ°¨μ  μ‹λ³„              β”‚
β”‚                                                           β”‚
β”‚  [μ μ–΄]                                                   β”‚
β”‚   β””β”€ Iron-MD λ¬΄μ„  μ΅°μΆ…κΈ°: CAN ν†µμ‹  λ‹¨λ™ μ μ–΄             β”‚
β”‚                                                           β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### μ‘μ—… μμ—­
- 1ν μ΄λ™λ‹Ή: 2x3 μ² κ·Ό κ²°μ† κµ¬μ—­ (6κ° κ²°μ†μ )
- κ° κµ¬μ—­μ—μ„ μμ°¨μ μΌλ΅ κ²°μ† μ‘μ—… μν–‰

## π”§ ν•λ“μ›¨μ–΄ κµ¬μ„±

| μ»΄ν¬λ„νΈ | ν†µμ‹  λ°©μ‹ | ν¬νΈ/μΈν„°νμ΄μ¤ | ν¨ν‚¤μ§€ |
|----------|-----------|-----------------|--------|
| RMD-X4 λ¨ν„° (7κ°) | CAN | can0 | rmd_robot_control |
| Pololu μ•΅μ¶”μ—μ΄ν„° | USB Serial | /dev/ttyACM0 | pololu_ros2 |
| Seengrip κ·Έλ¦¬νΌ | RS485 (Modbus RTU) | /dev/ttyUSB0 | seengrip_ros2 |
| EZI-IO λ¨λ“ | Ethernet (Modbus TCP) | 192.168.0.2:502 | ezi_io_ros2 |
| ZED X (2λ€) | USB 3.0 | - | zed_wrapper |
| ZED X Mini (2λ€) | USB 3.0 | - | zed_wrapper |
| Iron-MD μ΅°μΆ…κΈ° | **CAN 250Kbps** | **can1** | rebar_control |

## π“¦ ROS2 ν¨ν‚¤μ§€ κµ¬μ΅°

```
src/
β”β”€β”€ rmd_robot_control/      # RMD-X4 λ¨ν„° μ μ–΄ (0x141-0x147)
β”β”€β”€ pololu_ros2/            # Pololu μ•΅μ¶”μ—μ΄ν„° μ μ–΄
β”β”€β”€ seengrip_ros2/          # Seengrip κ·Έλ¦¬νΌ μ μ–΄
β”β”€β”€ ezi_io_ros2/            # EZI-IO λ¦¬λ―ΈνΈ μ„Όμ„
β”β”€β”€ rebar_control/          # ν†µν•© μ μ–΄ λ° ν…”λ μµ
β””β”€β”€ zed_wrapper/            # ZED μΉ΄λ©”λΌ (Stereolabs κ³µμ‹)
```

## π€ μ„¤μΉ λ° λΉλ“

### μμ΅΄μ„± μ„¤μΉ

```bash
# ROS2 Humble μ„¤μΉ ν•„μ”
sudo apt update
sudo apt install -y \
    ros-humble-desktop \
    ros-humble-joy \
    python3-serial \
    python3-pip

# Python ν¨ν‚¤μ§€
pip3 install pymodbus
```

### λΉλ“

```bash
cd ~/ros2_ws_backup
colcon build
source install/setup.bash
```

## π® μ‚¬μ©λ²•

### 1. μ „μ²΄ μ‹μ¤ν… μ‹¤ν–‰

```bash
# λ¨λ“  ν•λ“μ›¨μ–΄ λ…Έλ“ + ν…”λ μµ
ros2 launch rebar_control full_system.launch.py
```

### 2. κ°λ³„ ν…μ¤νΈ

#### μ£Όν–‰ μ‹μ¤ν…λ§ ν…μ¤νΈ
```bash
ros2 launch rebar_control test_driving.launch.py
```

#### XYZ μ¤ν…μ΄μ§€ + λ¦¬λ―ΈνΈ μ„Όμ„ ν…μ¤νΈ
```bash
ros2 launch rebar_control test_stage.launch.py
```

#### κ·Έλ¦¬νΌ + νΈλ¦¬κ±° ν…μ¤νΈ
```bash
ros2 launch rebar_control test_gripper.launch.py
```

## π® Iron-MD μ΅°μΆ…κΈ° λ§¤ν•‘

### μ—°μ† μ μ–΄ (μ•„λ‚ λ΅κ·Έ μ΅°μ΄μ¤ν‹±)
- **AN3 (μ΅°μ΄μ¤ν‹± 3)**: ν•λ¶€μ²΄ μ „ν›„μ§„ (0x141, 0x142)
- **AN1 (μ΅°μ΄μ¤ν‹± 1)**: μƒλ¶€μ²΄ Xμ¶• μ „ν›„ (0x144)
- **AN2 (μ΅°μ΄μ¤ν‹± 2)**: μƒλ¶€μ²΄ Yμ¶• μ „ν›„ (0x145)

### λ¨λ“ μ„ νƒ (3λ‹¨ ν† κΈ€ μ¤μ„μΉ)
- **S19 (μƒλ‹¨)**: Remote Control λ¨λ“ (μ΅°μΆ…κΈ° μ μ–΄)
- **μ¤‘λ¦½**: λ€κΈ°
- **S20 (ν•λ‹¨)**: Automatic Control λ¨λ“ (μƒμ„μ μ–΄ μ—°λ™)

### ν΅μ΄λ™ (3λ‹¨ ν† κΈ€ μ¤μ„μΉ - μ—£μ§€ νΈλ¦¬κ±°)
- **S17 ONβ†’OFF**: ν•λ¶€μ²΄ ν΅μ΄λ™ +50mm (0x143, 360λ„ νμ „)
- **S18 ONβ†’OFF**: ν•λ¶€μ²΄ ν΅μ΄λ™ -50mm (0x143, -360λ„ νμ „)

### μ‘μ—… μ‹ν€€μ¤ (3λ‹¨ ν† κΈ€ μ¤μ„μΉ - μ—£μ§€ νΈλ¦¬κ±°)
- **S21 ONβ†’OFF**: Zμ¶• 100mm ν•κ°• β†’ κ·Έλ¦¬νΌ λ‹«κΈ° (κ°„κ²© 0)
- **S22 ONβ†’OFF**: νΈλ¦¬κ±° λ™μ‘ β†’ κ·Έλ¦¬νΌ μ—΄κΈ° (κ°„κ²© 2000) β†’ Zμ¶• 100mm μƒμΉ

### Yaw νμ „ (3λ‹¨ ν† κΈ€ μ¤μ„μΉ - μ—£μ§€ νΈλ¦¬κ±°)
- **S23 ONβ†’OFF**: κ³µκµ¬ Yaw +30λ„ νμ „ (0x147)
- **S24 ONβ†’OFF**: κ³µκµ¬ Yaw -30λ„ νμ „ (0x147)

### κΈ°νƒ€ μ μ–΄
- **S00**: νΈλ¦¬κ±° λ‹ΉκΉ€ (μλ™)
- **S01**: νΈλ¦¬κ±° ν•΄μ  (μλ™)
- **Emergency Stop**: λΉ„μƒ μ •μ§€

> **μ°Έκ³ **: S17-S18, S21-S22, S23-S24λ” 3λ‹¨ μ¤μ„μΉλ΅ ON μ‹ νΈ ν›„ μ¤‘λ¦½μΌλ΅ λ³µκ·€ν•μ—¬ 1νλ§ λ™μ‘ν•©λ‹λ‹¤.

## π“΅ μ£Όμ” ν† ν”½

### λ…λ Ή ν† ν”½
| ν† ν”½ | νƒ€μ… | μ„¤λ… |
|------|------|------|
| `/cmd_vel` | geometry_msgs/Twist | μ£Όν–‰ μ μ–΄ |
| `/joint_1/position` | Float64MultiArray | λ¦¬ν”„ν… μ„μΉ |
| `/joint_2/position` | Float64MultiArray | Xμ¶• μ„μΉ |
| `/joint_3/position` | Float64MultiArray | Yμ¶• μ„μΉ |
| `/joint_4/position` | Float64MultiArray | Zμ¶• μ„μΉ |
| `/joint_5/position` | Float64MultiArray | Yaw μ„μΉ |
| `/motor_0/vel` | std_msgs/Float32 | νΈλ¦¬κ±° μ†λ„ |
| `/gripper/position` | std_msgs/Float32 | κ·Έλ¦¬νΌ μ„μΉ |
| `/emergency_stop` | std_msgs/Bool | λΉ„μƒ μ •μ§€ |

### μƒνƒ ν† ν”½
| ν† ν”½ | νƒ€μ… | μ„¤λ… |
|------|------|------|
| `/joint_states` | sensor_msgs/JointState | μ „μ²΄ κ΄€μ  μƒνƒ |
| `/limit_sensors/x_min` | std_msgs/Bool | Xμ¶• μµμ† λ¦¬λ―ΈνΈ |
| `/limit_sensors/x_max` | std_msgs/Bool | Xμ¶• μµλ€ λ¦¬λ―ΈνΈ |
| `/limit_sensors/y_min` | std_msgs/Bool | Yμ¶• μµμ† λ¦¬λ―ΈνΈ |
| `/limit_sensors/y_max` | std_msgs/Bool | Yμ¶• μµλ€ λ¦¬λ―ΈνΈ |
| `/limit_sensors/z_min` | std_msgs/Bool | Zμ¶• μµμ† λ¦¬λ―ΈνΈ |
| `/limit_sensors/z_max` | std_msgs/Bool | Zμ¶• μµλ€ λ¦¬λ―ΈνΈ |
| `/system/safe` | std_msgs/Bool | μ‹μ¤ν… μ•μ „ μƒνƒ |

## π›΅οΈ μ•μ „ κΈ°λ¥

### λ¦¬λ―ΈνΈ μ„Όμ„ λ¨λ‹ν„°λ§
- XYZ μ¤ν…μ΄μ§€ κ° μ¶•μ min/max λ¦¬λ―ΈνΈ μ„Όμ„ μ‹¤μ‹κ°„ κ°μ‹
- λ¦¬λ―ΈνΈ νΈλ¦¬κ±° μ‹ ν•΄λ‹Ή λ°©ν–¥ μ΄λ™ μ°¨λ‹¨
- κ²½κ³  λ©”μ‹μ§€ μ¶λ ¥

### λΉ„μƒ μ •μ§€
- SELECT λ²„νΌμΌλ΅ μ¦‰μ‹ λ¨λ“  λ¨ν„° μ •μ§€
- λΉ„μƒ μ •μ§€ μƒνƒμ—μ„λ” λ¨λ“  μ μ–΄ λ…λ Ή λ¬΄μ‹
- START λ²„νΌμΌλ΅ ν•΄μ 

### μ•μ „ λ¨λ‹ν„°
- `safety_monitor` λ…Έλ“κ°€ λ¨λ“  λ¦¬λ―ΈνΈ μ„Όμ„ κ°μ‹
- `/system/safe` ν† ν”½μΌλ΅ μ•μ „ μƒνƒ λ°ν–‰
- μ„ν— μƒν™© μλ™ κ°μ§€ λ° κ²½κ³ 

## π“ μ‘μ—… μ‹ν€€μ¤ μμ‹

```python
# 1. μ£Όν–‰: μ‘μ—… μ„μΉλ΅ μ΄λ™
#    - λ¬΄ν•κ¶¤λ„λ΅ μ „μ§„/ν›„μ§„, νμ „
#    - ZED X μΉ΄λ©”λΌλ΅ μ¥μ• λ¬Ό νν”Ό

# 2. λ¦¬ν”„ν…: λ†’μ΄ μ΅°μ • (step by step)
#    - 0x143 λ¨ν„°λ΅ 50mmμ”© μƒμΉ
#    - μ‘μ—… λ†’μ΄μ— λ„λ‹¬

# 3. λΉ„μ „: κµμ°¨μ  μ‹λ³„
#    - ZED X Miniλ΅ μ² κ·Ό κµμ°¨μ  νƒμ§€
#    - 2x3 κ·Έλ¦¬λ“μ—μ„ μ‘μ—… μμ„ κ²°μ •

# 4. XYZ μ¤ν…μ΄μ§€: κ³µκµ¬ μ΄μ†΅
#    - 0x144 (X), 0x145 (Y), 0x146 (Z)λ΅ μ •λ°€ μ„μΉ μ΄λ™
#    - 0x147 (Yaw)λ΅ κ°λ„ μ΅°μ •

# 5. κ·Έλ¦¬νΌ: μ² κ·Ό κ³ μ •
#    - SeengripμΌλ΅ κµμ°¨μ  μ² κ·Ό νμ§€
#    - ν”λ“¤λ¦Ό λ°©μ§€

# 6. κ²°μ†: νΈλ¦¬κ±° λ™μ‘
#    - Pololu μ•΅μ¶”μ—μ΄ν„°λ΅ νΈλ¦¬κ±° λ‹ΉκΉ€
#    - κ²°μ†μ„  κ°κΉ€ + μ λ‹¨ (μλ™)

# 7. λ‹¤μ ν¬μΈνΈ: λ°λ³µ
#    - 2x3 κµ¬μ—­ λ‚΄ 6κ° ν¬μΈνΈ μμ°¨ μ‘μ—…
```

## π” λ””λ²„κΉ… λ° λ¨λ‹ν„°λ§

### ν† ν”½ ν™•μΈ
```bash
# μ΅°μ΄μ¤ν‹± μ…λ ¥ ν™•μΈ
ros2 topic echo /joy

# μ£Όν–‰ λ…λ Ή ν™•μΈ
ros2 topic echo /cmd_vel

# λ¦¬λ―ΈνΈ μ„Όμ„ μƒνƒ
ros2 topic echo /limit_sensors/x_min

# κ΄€μ  μƒνƒ
ros2 topic echo /joint_states
```

### λ…Έλ“ μƒνƒ
```bash
# μ‹¤ν–‰ μ¤‘μΈ λ…Έλ“ ν™•μΈ
ros2 node list

# νΉμ • λ…Έλ“ μ •λ³΄
ros2 node info /teleop
```

### CAN ν†µμ‹  ν™•μΈ
```bash
# CAN μΈν„°νμ΄μ¤ μƒνƒ
ip link show can0  # RMD λ¨ν„°
ip link show can1  # Iron-MD μ΅°μΆ…κΈ°

# CAN λ©”μ‹μ§€ λ¨λ‹ν„°
candump can0  # RMD λ¨ν„° λ©”μ‹μ§€
candump can1  # Iron-MD μ΅°μΆ…κΈ° λ©”μ‹μ§€

# Iron-MD μ΅°μ΄μ¤ν‹± λ°μ΄ν„° ν™•μΈ
candump can1,1E4:7FF

# Iron-MD μ¤μ„μΉ μƒνƒ ν™•μΈ
candump can1,2E4:7FF
```

## π“ κ°λ³„ ν¨ν‚¤μ§€ λ¬Έμ„

κ° ν¨ν‚¤μ§€μ μμ„Έν• μ‚¬μ©λ²•μ€ ν•΄λ‹Ή README μ°Έκ³ :

- [rmd_robot_control/README.md](src/rmd_robot_control/README.md)
- [pololu_ros2/README.md](src/pololu_ros2/README.md)
- [seengrip_ros2/README.md](src/seengrip_ros2/README.md)
- [ezi_io_ros2/README.md](src/ezi_io_ros2/README.md)

## π”§ νΈλ¬λΈ”μν…

### CAN ν†µμ‹  λ¬Έμ 
```bash
# CAN μΈν„°νμ΄μ¤ ν™μ„±ν™”
sudo ip link set can0 up type can bitrate 1000000
```

### μ‹λ¦¬μ–Ό ν¬νΈ κ¶ν•
```bash
# μ„μ‹ κ¶ν•
sudo chmod 666 /dev/ttyACM0
sudo chmod 666 /dev/ttyUSB0

# μκµ¬ κ¶ν• (μ¬λ΅κ·ΈμΈ ν•„μ”)
sudo usermod -a -G dialout $USER
```

### Iron-MD μ΅°μΆ…κΈ° μΈμ‹ μ•λ¨
```bash
# CAN μΈν„°νμ΄μ¤ ν™•μΈ
ip link show can1

# CAN1 ν™μ„±ν™” (250 Kbps)
sudo ip link set can1 up type can bitrate 250000

# λ©”μ‹μ§€ μμ‹  ν…μ¤νΈ
candump can1

# μμƒ μ¶λ ¥:
# can1  1E4   [8]  7F 7F 7F 7F 00 00 00 00  <- μ΅°μ΄μ¤ν‹±
# can1  2E4   [8]  00 00 00 00 00 00 00 00  <- μ¤μ„μΉ
# can1  764   [8]  00 00 00 00 00 00 00 00  <- Heartbeat
```

### EZI-IO μ—°κ²° μ•λ¨
```bash
# IP μ—°κ²° ν™•μΈ
ping 192.168.0.2

# λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤ μ„¤μ •
sudo ip addr add 192.168.0.100/24 dev eth0
```

## π¦ λ‹¤μ λ‹¨κ³„

μ΄ ν•μ„μ μ–΄ μ‹μ¤ν…μ€ **λ¬΄μ„  μ΅°μΆ…κΈ°λ¥Ό ν†µν• λ‹¨λ™ μ μ–΄**λ¥Ό μ™„λ²½ν•κ² μ§€μ›ν•©λ‹λ‹¤.

ν–¥ν›„ κ°λ°:
1. **μƒμ„ μ μ–΄ μ‹μ¤ν…**: μλ™ μ‘μ—… μ‹ν€€μ¤
2. **λΉ„μ „ ν†µν•©**: ZED μΉ΄λ©”λΌ λ°μ΄ν„° ν™μ©
3. **κ²½λ΅ κ³„ν**: μλ™ λ„¤λΉ„κ²μ΄μ…
4. **μ‘μ—… κ΄€λ¦¬**: 2x3 κ·Έλ¦¬λ“ μ‘μ—… μ¤μΌ€μ¤„λ§

## π“„ λΌμ΄μ„Όμ¤

MIT License

## π‘¥ κΈ°μ—¬

λ³Έ μ‹μ¤ν…μ€ μ² κ·Ό κ²°μ† μλ™ν™”λ¥Ό μ„ν• ν•μ„ μ μ–΄ ν¨ν‚¤μ§€μ…λ‹λ‹¤.
μƒμ„ μ μ–΄ μ‹μ¤ν…κ³Ό ν†µν•©ν•μ—¬ μ™„μ „ν• μλ™ν™”λ¥Ό κµ¬ν„ν•  μ μμµλ‹λ‹¤.
