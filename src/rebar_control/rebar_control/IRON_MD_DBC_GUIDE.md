# IRON-MD ì¡°ì´ìŠ¤í‹± CAN DBC íŒŒì¼ ê°€ì´ë“œ

## ğŸ“„ íŒŒì¼ ì •ë³´
- **íŒŒì¼ëª…**: `iron_md_joystick.dbc`
- **ì¥ì¹˜**: IRON-MD ë¬´ì„  ì›ê²© ì¡°ì´ìŠ¤í‹± (DAS_99_MD)
- **í†µì‹ **: CAN 2.0B
- **Baudrate**: 125/250/500 Kbps (ì„ íƒ ê°€ëŠ¥, ê¸°ë³¸ 250Kbps)

## ğŸ”Œ í•˜ë“œì›¨ì–´ ì—°ê²°
### IRON-MD ìˆ˜ì‹ ê¸° 7í•€ ì»¤ë„¥í„° (SF1212/S7)
```
1: CAN_L (í°ìƒ‰)
2: CAN_H (ë…¹ìƒ‰)
3: NC
4: Power GND (0V) (í‘ìƒ‰)
5: Power+ (24V) (ë¹¨ê°•)
6: RS232_TX (ì²­ìƒ‰)
7: RS232_RX (ë³´ë¼)
```

### IRON-MD ì†¡ì‹ ê¸°ì¸¡ 7í•€ ì»¤ë„¥í„°
```
1: USB-5V_in (ë¹¨ê°•)
2: USB-DP (ë…¸ë‘)
3: CAN-H/RS232 TX (ì²­ìƒ‰)
4: POWER 24V_in (ë¹¨ê°•)
5: CAN-L/RS232 RX (ë³´ë¼)
6: USB-DN (ë°±ìƒ‰)
7: 0V/GND (í‘ìƒ‰/ì´ˆë¡)
```

## ğŸ“¡ CAN ë©”ì‹œì§€ ì •ì˜

### 1ï¸âƒ£ ì¡°ì´ìŠ¤í‹± ë°ì´í„° (0x1E4 / 484)
- **ë°©í–¥**: TX (ì†¡ì‹ ê¸° â†’ ìˆ˜ì‹ ê¸°)
- **ì£¼ê¸°**: 50ms
- **ê¸¸ì´**: 8 bytes

| Byte | Signal | ë²”ìœ„ | ì„¤ëª… |
|------|--------|------|------|
| 0 | Joystick_1 | 0-255 | ì¡°ì´ìŠ¤í‹± 1 ì•„ë‚ ë¡œê·¸ ê°’ |
| 1 | Joystick_2 | 0-255 | ì¡°ì´ìŠ¤í‹± 2 ì•„ë‚ ë¡œê·¸ ê°’ |
| 2 | Joystick_3 | 0-255 | ì¡°ì´ìŠ¤í‹± 3 ì•„ë‚ ë¡œê·¸ ê°’ |
| 3 | Joystick_4 | 0-255 | ì¡°ì´ìŠ¤í‹± 4 ì•„ë‚ ë¡œê·¸ ê°’ |
| 4-7 | - | - | ì‚¬ìš© ì•ˆí•¨ |

### 2ï¸âƒ£ ìŠ¤ìœ„ì¹˜ ìƒíƒœ (0x2E4 / 740)
- **ë°©í–¥**: TX (ì†¡ì‹ ê¸° â†’ ìˆ˜ì‹ ê¸°)
- **ì£¼ê¸°**: 50ms
- **ê¸¸ì´**: 8 bytes

#### Byte 0 (ì œì–´ ë²„íŠ¼)
| Bit | Signal | ì„¤ëª… |
|-----|--------|------|
| 0 | Start_Key | ì‹œì‘ í‚¤ |
| 1 | Power_Key | ì „ì› ì˜¨ í‚¤ |
| 2 | Engine_Start | ì—”ì§„ ì‹œì‘ (S13) |
| 3 | Engine_Stop | ì—”ì§„ ì •ì§€ (S14) |
| 4-5 | - | ì‚¬ìš© ì•ˆí•¨ |
| 6 | Emergency_Stop_Release | 0: ë¹„ìƒì •ì§€, 1: í•´ì œ |
| 7 | Emergency_Stop_Active | 1: ë¹„ìƒì •ì§€, 0: í•´ì œ |

#### Byte 1 (ìŠ¤ìœ„ì¹˜ S00-S07)
| Bit | Signal | ì„¤ëª… |
|-----|--------|------|
| 0 | Switch_S06 | ìŠ¤ìœ„ì¹˜ S06 |
| 1 | Switch_S07 | ìŠ¤ìœ„ì¹˜ S07 |
| 2-3 | - | ì‚¬ìš© ì•ˆí•¨ |
| 4 | Switch_S02 | ìŠ¤ìœ„ì¹˜ S02 |
| 5 | Switch_S03 | ìŠ¤ìœ„ì¹˜ S03 |
| 6 | Switch_S01 | ìŠ¤ìœ„ì¹˜ S01 |
| 7 | Switch_S00 | ìŠ¤ìœ„ì¹˜ S00 |

#### Byte 2 (ìŠ¤ìœ„ì¹˜ S08-S09)
| Bit | Signal | ì„¤ëª… |
|-----|--------|------|
| 0 | Switch_S08 | ìŠ¤ìœ„ì¹˜ S08 |
| 1 | Switch_S09 | ìŠ¤ìœ„ì¹˜ S09 |
| 2-7 | - | ì‚¬ìš© ì•ˆí•¨ |

#### Byte 3 (ìŠ¤ìœ„ì¹˜ S17-S24)
| Bit | Signal | ì„¤ëª… |
|-----|--------|------|
| 0 | Switch_S23 | ìŠ¤ìœ„ì¹˜ S23 |
| 1 | Switch_S24 | ìŠ¤ìœ„ì¹˜ S24 |
| 2 | Switch_S21 | ìŠ¤ìœ„ì¹˜ S21 |
| 3 | Switch_S22 | ìŠ¤ìœ„ì¹˜ S22 |
| 4 | Switch_S19 | ìŠ¤ìœ„ì¹˜ S19 |
| 5 | Switch_S20 | ìŠ¤ìœ„ì¹˜ S20 |
| 6 | Switch_S17 | ìŠ¤ìœ„ì¹˜ S17 |
| 7 | Switch_S18 | ìŠ¤ìœ„ì¹˜ S18 |

#### Byte 4 (ìƒíƒœ ì •ë³´)
| Bit | Signal | ë²”ìœ„ | ì„¤ëª… |
|-----|--------|------|------|
| 0-3 | Run_Counter | 0-15 | ìˆ˜ì‹  ì‹ í˜¸ ì¹´ìš´í„° |
| 4 | Cal_Mode | 0/1 | 0: ì¼ë°˜ëª¨ë“œ, 1: ì¡°ì •ëª¨ë“œ |
| 5-7 | - | - | ì‚¬ìš© ì•ˆí•¨ |

#### Byte 5-7 (ì¥ì¹˜ ì •ë³´)
| Byte | Bit | Signal | ë²”ìœ„ | ì„¤ëª… |
|------|-----|--------|------|------|
| 5 | 6 | TX_Connected | 0/1 | 1: ì†¡ì‹ ê¸° ì—°ê²°ë¨ |
| 5 | 7 | TRX_Code | 0/1 | 1: ì†¡ì‹ ê¸°, 0: ìˆ˜ì‹ ê¸° |
| 6 | 0-7 | Serial_Number | 0-255 | ê¸°ê¸° ë²ˆí˜¸ (ì°¸ê³ ìš©) |
| 7 | 0-7 | Device_ID | 0-255 | ê¸°ê¸° ID (ì°¸ê³ ìš©) |

### 3ï¸âƒ£ Heartbeat (0x764 / 1892)
- **ë°©í–¥**: TX (ì†¡ì‹ ê¸° â†’ ìˆ˜ì‹ ê¸°)
- **ì£¼ê¸°**: 300ms
- **ê¸¸ì´**: 8 bytes

| Byte | Signal | ê°’ | ì„¤ëª… |
|------|--------|-----|------|
| 0 | Heart_Bit | 0 | ìƒì¡´ ì‹ í˜¸, í•­ìƒ 0 ì¶œë ¥ |

### 4ï¸âƒ£ LCD ë””ìŠ¤í”Œë ˆì´ (0x364 / 868) - ì˜µì…˜, ë¯¸ì‚¬ìš©
- **ë°©í–¥**: RX (ìˆ˜ì‹ ê¸° â†’ ì†¡ì‹ ê¸°)
- **ì£¼ê¸°**: >100ms
- **ê¸¸ì´**: 8 bytes

| Byte | Signal | ë²”ìœ„ | ì„¤ëª… |
|------|--------|------|------|
| 0 | Line_Index | 0-15 | LCD ë¼ì¸ ë²ˆí˜¸ (12 ì´ìƒ ë¬´ì‹œ) |
| 1 | Data_Index | 0-10 | ë¬¸ì ìœ„ì¹˜ (8 ì´ìƒ ë¬´ì‹œ) |
| 2-7 | Data_0-5 | 0-255 | í‘œì‹œí•  ë¬¸ì ë°ì´í„° |

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. CAN ì¸í„°í˜ì´ìŠ¤ ì„¤ì •
```bash
# CAN0ì„ 250Kbpsë¡œ ì„¤ì •
sudo ip link set can0 type can bitrate 250000
sudo ip link set can0 up

# ë‹¤ë¥¸ Baudrate ì‚¬ìš©ì‹œ
# 125Kbps: bitrate 125000
# 500Kbps: bitrate 500000
```

### 2. CAN ë©”ì‹œì§€ ëª¨ë‹ˆí„°ë§
```bash
# í¸ë¦¬í•œ ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©
./can_monitor.sh

# ë˜ëŠ” ì§ì ‘ candump ì‚¬ìš©
candump can0

# íŠ¹ì • IDë§Œ í•„í„°ë§
candump can0,1E4:7FF  # ì¡°ì´ìŠ¤í‹± ë°ì´í„°ë§Œ
candump can0,2E4:7FF  # ìŠ¤ìœ„ì¹˜ ìƒíƒœë§Œ
```

### 3. ROS2ì—ì„œ ì‚¬ìš©
```bash
# ros2_socketcan ì‚¬ìš© ì˜ˆì‹œ
ros2 run socketcan_bridge socketcan_bridge_node --ros-args \
  -p interface:=can0 \
  -p dbc_file:=/home/koceti/ros2_ws/iron_md_joystick.dbc
```

## ğŸ“Š ë°ì´í„° í•´ì„ ì˜ˆì‹œ

### ì¡°ì´ìŠ¤í‹± ì¤‘ì•™ê°’
```
CAN ID: 0x1E4
Data: 80 80 80 80 00 00 00 00
í•´ì„: ëª¨ë“  ì¡°ì´ìŠ¤í‹±ì´ ì¤‘ì•™ (128, 0x80)
```

### ë¹„ìƒì •ì§€ í™œì„±í™”
```
CAN ID: 0x2E4
Data: C0 00 00 00 ...
í•´ì„: Bit 7=1, Bit 6=0 â†’ ë¹„ìƒì •ì§€ ìƒíƒœ
```

### ì—”ì§„ ì‹œì‘ ë²„íŠ¼
```
CAN ID: 0x2E4
Data: 04 00 00 00 ...
í•´ì„: Bit 2=1 â†’ ì—”ì§„ ì‹œì‘ (S13)
```

## ğŸ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### CAN ë©”ì‹œì§€ê°€ ì•ˆ ë³´ì¼ ë•Œ
```bash
# 1. ì¸í„°í˜ì´ìŠ¤ ìƒíƒœ í™•ì¸
ip link show can0
# UP,RUNNING ìƒíƒœì—¬ì•¼ í•¨

# 2. Baudrate í™•ì¸ (ì†¡ì‹ ê¸° ì„¤ì •ê³¼ ì¼ì¹˜í•´ì•¼ í•¨)
ip -details link show can0

# 3. ì—ëŸ¬ í™•ì¸
ip -s link show can0

# 4. ì¬ì‹œì‘
sudo ip link set can0 down
sudo ip link set can0 type can bitrate 250000
sudo ip link set can0 up
```

### DBC íŒŒì¼ ê²€ì¦
```bash
# cantools ì„¤ì¹˜
pip install cantools

# DBC íŒŒì¼ íŒŒì‹± í…ŒìŠ¤íŠ¸
python3 << EOF
import cantools
db = cantools.database.load_file('iron_md_joystick.dbc')
print("Messages:")
for msg in db.messages:
    print(f"  {msg.name} (0x{msg.frame_id:X})")
EOF
```

## ğŸ“ ì°¸ê³  ì‚¬í•­

1. **ë¹„ìƒì •ì§€**: ë‘ ê°œì˜ Emergency Stop ì‹ í˜¸ê°€ ìˆìŒ (bit 6, 7) - ì¤‘ë³µ ì•ˆì „ ê¸°ëŠ¥
2. **ìŠ¤ìœ„ì¹˜ ë²ˆí˜¸**: S10-S16ì€ ì •ì˜ë˜ì§€ ì•ŠìŒ (ë¬¸ì„œì— ì—†ìŒ)
3. **LCD ê¸°ëŠ¥**: ìˆ˜ì‹  ì „ìš©ì´ë©° ì˜µì…˜ ê¸°ëŠ¥ (í˜„ì¬ ë¯¸ì‚¬ìš©)
4. **Run Counter**: 0-15 ë²”ìœ„ë¡œ ìˆœí™˜í•˜ë©° ë©”ì‹œì§€ ìˆ˜ì‹  í™•ì¸ìš©
5. **TRX Code**: ì†¡ìˆ˜ì‹ ê¸° êµ¬ë¶„ (1=ì†¡ì‹ ê¸°, 0=ìˆ˜ì‹ ê¸°)

## ğŸ“š ê´€ë ¨ íŒŒì¼
- DBC íŒŒì¼: `/home/koceti/ros2_ws/iron_md_joystick.dbc`
- ë¬¸ì„œ: `/home/koceti/ros2_ws/IRON-MD_CAN_Specification.md`
- ëª¨ë‹ˆí„° ìŠ¤í¬ë¦½íŠ¸: `/home/koceti/ros2_ws/can_monitor.sh`
